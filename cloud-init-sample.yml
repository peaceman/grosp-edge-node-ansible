#cloud-config
package_upgrade: true
packages:
  - git
  - python3-pip

write_files:
  - path: /root/consul-ca.pem
    encoding: gz+b64
    content: |
      H4sIADhKWl8AA2WSu5KbMBhGe54ivccDBGyzRYpfSAZhkBHI186ALVbgG75gePp4N5k0+cozX3NmznD4HiIeZT9ckgg6pS4I8gWHWkQpksJ1ge8ltBSBpIt4wF3C7Lulm916Nij3tXKJb++MymlduaGz85b2yiDvf6sBhv20NboIwygS0M7xwmQ42L1Z/82w/McigLZQwJHMr2Wl5jGnSENy0UjOgUr2CZDy4+mD9nqXWyip/fuOCVypbFlAfMl+ui/r4Vc1Jlk+eTjb0BePu5Zbq6Q+VMtdPQtvcVf6zN8cwtYMVWl9CuPaus/R+tmu47Jn1uOWJV4D9vFDrLzMO9EOa+H0wWUqi2dkZrBcKa4QRGB7YC4K3BKkt/zLFZUKYiTZ0k8iBAeHIPGW576uRcj4c5Z8hVCyTE9+QwZRlm1J0h3cazA+3VLmlaKHGZLyrzvHINkZMKo1UCi4vMYTir2apvnkmQQhxOfOIeEVdLZi8faqisZ2dAONSlHdds2NOyyq4vUGUrfVRil3I47tdWeZQllBnqoMNePty6w/zMtxfnkWG9hDl04vl5d0ZlwYk2nQD0TQnArWCS06NHrWbX5p31kQhv9P5Tc/LjGuRwIAAA==
  - path: /root/gossip.key
    encoding: gz+b64
    content: |
      H4sIAHdKWl8AAyst8DD3KTNxLqxKikjJKXLySSlMyki3tQUAnhO9pxgAAAA=
  - path: /root/extra-vars.yml
    encoding: gz+b64
    content: |
      H4sIAAjIW18AA3WQTW7EIAyF95yCC4RUrbrJqjdBHnAIGoMRJqPM7Us6P9JMFS/f+/T87IWlZUg4aY/UwIRm8ufXx7ehmM/KcZaVrGC9YLWZPcqktB40UFne4V0/4b+MXQ6Q0kF2YJFY7Bmvdo7Ue4yVuY032XT5ATp4AW7q4MAUTCpBJAsUQVDs7k86x60L/BN2zzhOClxCixlOhH7SM5CgyiHmzYqQ9UuBCukOPHyHtdlQeS33y4+fpft47tvyH7rPcAg2ekLCa3U9U5DmQWLI6FWpvF37yW5B21e3ir3ZWmnSS2u9yjhKgxadgZfkXwk2QaPOAQAA

runcmd:
  - pip3 install ansible
  - git clone --recursive https://github.com/peaceman/grosp-edge-node-ansible /root/ansible-provisioning
  - |
    cd /root/ansible-provisioning \
    && ./install-deps.sh \
    && ansible-playbook -e '@/root/extra-vars.yml' local.yml

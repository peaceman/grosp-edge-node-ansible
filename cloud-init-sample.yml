#cloud-config
package_upgrade: true
packages:
  - git
  - python3-pip

write_files:
  - path: /root/consul-ca.pem
    encoding: gz+b64
    content: |
      H4sIADhKWl8AA2WSu5KbMBhGe54ivccDBGyzRYpfSAZhkBHI186ALVbgG75gePp4N5k0+cozX3NmznD4HiIeZT9ckgg6pS4I8gWHWkQpksJ1ge8ltBSBpIt4wF3C7Lulm916Nij3tXKJb++MymlduaGz85b2yiDvf6sBhv20NboIwygS0M7xwmQ42L1Z/82w/McigLZQwJHMr2Wl5jGnSENy0UjOgUr2CZDy4+mD9nqXWyip/fuOCVypbFlAfMl+ui/r4Vc1Jlk+eTjb0BePu5Zbq6Q+VMtdPQtvcVf6zN8cwtYMVWl9CuPaus/R+tmu47Jn1uOWJV4D9vFDrLzMO9EOa+H0wWUqi2dkZrBcKa4QRGB7YC4K3BKkt/zLFZUKYiTZ0k8iBAeHIPGW576uRcj4c5Z8hVCyTE9+QwZRlm1J0h3cazA+3VLmlaKHGZLyrzvHINkZMKo1UCi4vMYTir2apvnkmQQhxOfOIeEVdLZi8faqisZ2dAONSlHdds2NOyyq4vUGUrfVRil3I47tdWeZQllBnqoMNePty6w/zMtxfnkWG9hDl04vl5d0ZlwYk2nQD0TQnArWCS06NHrWbX5p31kQhv9P5Tc/LjGuRwIAAA==
  - path: /root/gossip.key
    encoding: gz+b64
    content: |
      H4sIAHdKWl8AAyst8DD3KTNxLqxKikjJKXLySSlMyki3tQUAnhO9pxgAAAA=
  - path: /root/nss-ca.pem
    encoding: gz+b64
    content: |
      H4sIAKLHYF8AA2WQyXKCQBiE7zxFXsASVFJ6yOH/Z4FBBxwWl9xkNVFjABXh6UNMVXJIH7/q7urqwaAXMku4T4T5oeCCQMi+4UCTQiB0BC8lUCgYgb2qieNFyezNot65iBIeX4thVbfLUfAOHAtZvW6g6d0Zb/RWkxRMGaq7S2Unu9Wuh90PE79MAjTzvzAVCkc8jsOrYZjabh84iNyyxmx9vRm6nTuZgGgxC26LzWyxX5YukQwaWmzpyteXoOwhgurXWpaEqaWBEaWsYThsFJcgEfJpY6uH2UPcMk6zFl3vsP9MA/dmGumBSD8op0cnG0qI+oL2ckzARSCHWF/Mj1l+yhWey9NuPKlKpFXrrfP7Jsl900tsq3M8/8NBI3pei7sJtNNS4te2uxYqH0f3QzKN63QSYrq0c33LYfuiPb5mLv3//xePmgJinAEAAA==
  - path: /root/nss-cert.pem
    encoding: gz+b64
    content: |
      H4sIAPLHYF8AA2WSTZOiMBCG7/yKvVsWiAhymEOHhJhxgwYIU3Dza+LyIaOyFeDXL2vVzmX7+HS/Vf2+3fP5VIhQFv0ISJyykAWQkr9wbnDG0GEMAohtBZohUEzuE9QMbnUfWjsPqplCDW63xVHtV1IjkeOtnWkOoDfXU2TwEvQuJRZPpRWN0vmYIB9fbPhmJaQ8JhrrHGdCYAzXuqDn+tj4lVGkcOcgKQxdfQJ+hQgvulhE+33vKSepe/AvMQHHvpqp1zdDIpDfRSSu8i+3dWg2WaAJR5zCQp6JEJzDPQhoVhV29vtoxzUH59XDmiBTCzLZDFsMZ6SibJNIYoQlSKTUAykSInHCIHK21TlCQm6mYY1hWju2UhAbEwHT8E8sHBIqIY3wNC5l0VEaO15UrMeP6jP6dWtgJ6eQ9EtcIqR02IKMPEYsN6H1gtnmLbMF60Nj+xhk7a2/0wWLwMMcds+nZ/Nuffic+aylYjbLats9LPvLzangcC+y96+zu7p5xhPic+npW2x18FhUcBLp+2ppNtfVw70UPpQJPfxU/oj125vxujyJ8P/f8AfkhGqoKgIAAA==
  - path: /root/nss-cert-key.pem
    encoding: gz+b64
    content: |
      H4sIAArIYF8AA9PVBQInV3dPP4WAIM8wxxBXBW/XSJCgLpevs4mzY6BjuVNgpIu3UVi5k7Onq6dfhKu+n5tLvmdVpUV4gatPQGSOd7anpVO+e2ZZknewfkhxhHaYaWhQan4UF9gYVz8XTKMBllQbAXcAAAA=
  - path: /root/extra-vars.yml
    encoding: gz+b64
    content: |
      H4sIANnIYF8AA3WRQW6EMAxF95wiFyBUrbph1ZtEnsSEaJwExaFibl/DDJVgRJbvP31bzpi5JojYK4dUQfuq0+fXx7emkO6NzYlnMozlF4tJ2SH3jVKtAprGs7zyG751rNhDjBfdPjOHydzxYYZAskdXcq7dE2vBu2jhIDxpa0FPGJvEfBYEHVIs9T0XeDTOe+xWK8FmRghkgAIwslmVXqWwCMg/fs20zbEBG9Fgghuh69UAxNgkH9JimMm4cYIC8SXs+TbelzxPrxtff4uS57JMS5u6vvZSrPQvcZ6LlU5GGloOPqFrppKXh9zOjmhkdC0om82FejXWKqt0HVeowWo4NP8Bh5WSGTgCAAA=
  - path: /root/proxy-cache.pem
    encoding: gz+b64
    content: |
      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
  - path: /root/proxy-cache-key.pem
    encoding: gz+b64
    content: |
      H4sIAGv1YF8AA22Vt7KjagCDe57i9MwOxiRT/uScwUCHyTknP/09u/VVpRk136iQ/vz5FcOLsvHjuODHcuQAePyPykd/gz+QLsv8eMoMACoLbB48Toriqz0kQLPi492cVhqs4uQayDH4VfRuejcje6XaSzPeE/MDkb4/XOmrl3q5XvypQZ+bmAtJguyfwqRp++HJFS2xnYyaPe75/rLIz27XywUJGu5sX5AsY9vRKY+Oib4RPpN7UiNxa+3vqjasxUWEi2PWGUWXtxyy2mLmbXsVD4X56OeWb08Loj71G/7wyH1kAxx1WCY3DiXoiM3Rg+fMZF8cSELf33JExAeZ5SoQL+3y6YGwpHA8EYjOK5nylBDsEyUFikxvb5RebNdnSSPV9MqHy9a7r5Bwb5dj5o0SqaQvSn25Yz0+qxgSOjjXW/nbkznR0OMqtiDqqS9lfgChc2075kdTnDIHbMCA8bdspuuKyp32ICV0qsAgXgwctLzUcI/jGYtCrTNHlmZgvwYZvG7EOehK6IeuFkTmYPWxhsQdzVLJ10I0jQ1ISKeEqLK6m5LPeFk9eGGdyw8udeEJwG7CHtpHcHOH37Fk0PnowVUeKjy08beYbLUEG1rHUARiY6yTYKcdn/bvomo3fnlnQEsTlmMj+XldmYRizY4wmy0zft6OYp0n1jGp4gUlkdHYmOB/khoezmJ5ssov4ak7A3z7C8COAYwI7T7T6OoGd6BTGo0RA1aRLFPyekihdJ0A8MUNU4mC/bYu3j1RxdueS0Ar+HdngmoTi8HQT4OkPRzhpRdHU4ktCLcpjIUtQA8bX32PZ8uIB1QdG7wUrHkcfkRDNd29vpg0N+3sPIih7UQw2ofoJ0Xrc5PfRaIEq5AytHNzzZ6byRd+rpeMpUXxPCJ39drMfOjSzVj6WPKY/1UZoTVnHTA3yxWvDmC1lftQUTiWvXUD2J8m6wYkY4xWZzHF3c7HFzOeAlnI9RktU6JSthP1ijayc+b/I8Z3LoJGm0ZWhsCCNrEfIt+Xlj+U+s3jKOv2VovtOZ+oHELGDiXP4x5dGmsKaeTh+3nRB69BzSipzBvMJfEVv64UGqVrkUS8uuVIxWBuDJTiiOl2SNzykm1W8cD4vAJHNIjy9jm5h7Jqs6YX/KB9mByi7Jmzmp20DkP7bX+raRyLreOV+i8yszSp+9A5mwuDWmfQI5LMVYCoL6j1/oHNmMZZU/UKPe/ACjorlep9Mxqcu8QWbv5tvoYBaRAa9P3kiOhjug04uqsU8rrH07isJagbM89lFxacYEZ0XOqI9+c5ug+x9+qgmBtlKdTpEHH3frw9XblRVApihIDwg2LMTT6q2pfmKm1eV6Q/bZUpbbbCmf1szriBtyb55gRqoUfVnV2ZyefL4Rr/0K4Ngon4rUeIOQ3gWRwmIW8w/QwICYwwd+d1iriYZTJRFn0+7y5Lii8jclhZBAvIeL7QbqhateOgEjrHu0BjG0pjP935NnDjm+0P49di5y0QTdas6DFz9JNkQarXGV1ipz30bQiNGJz5f5H5a2fLRJ0+oqsgOHaA2du8wVHQ0Cr93Z3zfdglnmiHMA2HkKxElLdY/QVNfr30L/TlOZV0iSR9SlHPJSFHV9fDDWDVzx3fwlKlKr8TfgdObkw6LvSkT6ZE+QEiBIK6lxn9sanFapUKPEirCrpXkkee+j5hWK/m3ZaxWr5Pu3B/58BeKOjfpfAG9/9X8x/uP8rJiwYAAA==

runcmd:
  - pip3 install ansible
  - git clone --recursive https://github.com/peaceman/grosp-edge-node-ansible /root/ansible-provisioning
  - |
    cd /root/ansible-provisioning \
    && ./install-deps.sh \
    && ansible-playbook -e '@/root/extra-vars.yml' local.yml
